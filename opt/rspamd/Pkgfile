# Description: rspamd

name=rspamd
version=git
release=1
source=(
    https://github.com/rspamd/rspamd.git
    $name.patch
    $name.rc
)

build()
{
    # install -D -m 755 $SRC/$name.rc $PKG/etc/rc.d/$name
    cd $name
    git submodule update --recursive --remote
    # patch -p0 -i $SRC/$name.patch
    mkdir build
    cd build
    cmake .. \
          -DCMAKE_C_OPT_FLAGS="${CFLAGS}" \
          -DCONFDIR="/etc/rspamd" \
          -DDBDIR="/var/rspamd" \
          -DLOGDIR="/var/log/rspamd" \
          -DMANDIR="/usr/local/man" \
          -DRUNDIR="/var/run/rspamd" \
          -DRSPAMD_USER="_rspamd" \
          -DENABLE_LTO=OFF \
          -DENABLE_LUAJIT=OFF
    make
    make install DESTDIR=$PKG
}
